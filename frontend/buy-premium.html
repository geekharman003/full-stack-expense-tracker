<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Buy Premium</title>
    <link rel="stylesheet" href="styles.css" />
    <script src="https://sdk.cashfree.com/js/v3/cashfree.js"></script>
  </head>
  <body>
    <header>
      <nav>
        <ul id="navigation-list">
          <li><a href="index.html">Home</a></li>
          <!-- <li><a href="about.html">About</a></li> -->
          <li><a href="#">Buy Premium</a></li>
        </ul>
        <div id="logout-container">
          <button type="button" id="logout-btn" onclick="logout()">
            Logout
            <img
              width="15"
              height="15"
              style="color: white"
              src="images/icons/logout-svgrepo-com.svg"
              alt="logout"
            />
          </button>
        </div>
      </nav>
    </header>
    <div id="buy-premium-main" class="main">
      <div id="buy-premium-container">
        <div id="premium-img-container">
          <img
            id="premium-img"
            width="100"
            height="100"
            src="images/icons/crown-svgrepo-com.svg"
            alt="crown icon"
          />
        </div>
        <h2>Premium Features</h2>
        <ul id="premium-features-list">
          <li><span>See Top Spenders</span></li>
          <li>
            <span>Download Expenses as text file</span>: Export Your Data Easily
          </li>
        </ul>
        <button id="buy-premium-btn">Buy Premium</button>
      </div>
    </div>

    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.11.0/axios.min.js"
      integrity="sha512-h9644v03pHqrIHThkvXhB2PJ8zf5E9IyVnrSfZg8Yj8k4RsO4zldcQc4Bi9iVLUCCsqNY0b4WXVV4UB+wbWENA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>

    <script>
      const token = localStorage.getItem("token");

      if (token) {
        // verify the token
        axios
          .get("http://localhost:3000/", {
            headers: { authorization: token },
          })
          .then((res) => {
            return;
          })
          .catch(() => {
            window.location.href = "/frontend/login.html";
          });
      } else {
        window.location.href = "/frontend/login.html";
      }
    </script>

    <script>
      document.addEventListener("DOMContentLoaded", async function () {
        const premiumBtn = document.getElementById("buy-premium-btn");
        const premiumImg = document.getElementById("premium-img");
        const buyPremiumBtn = document.getElementById("buy-premium-btn");

        const res = await axios.get("http://localhost:3000/", {
          headers: { authorization: token },
        });

        const { isPremium } = res.data.decoded;

        if (isPremium) {
          premiumImg.src = "images/icons/happy-emoji-svgrepo-com.svg";
          premiumBtn.textContent = "you are now a premium user";
          premiumBtn.setAttribute("disabled", "true");
          buyPremiumBtn.style.cursor = "not-allowed";
        }
      });
    </script>
    <script src="cashfree.js"></script>
    <script src="script.js"></script>
  </body>
</html>
